import React, {useEffect, useState} from 'react'; import { CONTRACT_ADDRESS, CONTRACT_ABI } from './utils/contract'; import { ethers } from 'ethers'; import './styles.css';
function fheEncrypt(choice){ return btoa(JSON.stringify({v:choice,t:Date.now()})); }
export default function App(){ const [account,setAccount]=useState(null); const [proposals,setProposals]=useState([]); const [status,setStatus]=useState('ready'); const [encryptedSample,setEncryptedSample]=useState(''); useEffect(()=>{ if(window.ethereum){ window.ethereum.on('accountsChanged',(a)=>setAccount(a[0]||null)); } loadProposals() },[]);
async function connect(){ if(!window.ethereum){ alert('Please install MetaMask or OKX Wallet'); return;} const accounts = await window.ethereum.request({method:'eth_requestAccounts'}); setAccount(accounts[0]); }
async function loadProposals(){ try{ const provider = new ethers.BrowserProvider(window.ethereum); const contract = new ethers.Contract(CONTRACT_ADDRESS, CONTRACT_ABI, provider); const data = await contract.getProposals(); const mapped = data.map(p=>({name:p.name, votes: p.voteCount.toString()})); setProposals(mapped); }catch(e){ console.error(e); setStatus('load failed') } }
async function submitVote(index){ if(!account){ alert('Please connect wallet'); return; } try{ const cipher = fheEncrypt(index); setEncryptedSample(cipher); const provider = new ethers.BrowserProvider(window.ethereum); const signer = await provider.getSigner(); const contract = new ethers.Contract(CONTRACT_ADDRESS, CONTRACT_ABI, signer); setStatus('submitting tx...'); const tx = await contract.vote(index); await tx.wait(); setStatus('vote submitted'); await loadProposals(); }catch(e){ console.error(e); setStatus('vote failed: '+(e.reason||e.message||e)); } }
async function viewWinner(){ try{ const provider = new ethers.BrowserProvider(window.ethereum); const contract = new ethers.Contract(CONTRACT_ADDRESS, CONTRACT_ABI, provider); const w = await contract.getWinner(); alert('Winner: ' + w[0] + ' (' + w[1].toString() + ' votes)'); }catch(e){ console.error(e); setStatus('get winner failed') } }
return (<div className='container'><h1 style={{textAlign:'center'}}>Zama Vote Demo</h1><p style={{textAlign:'center'}}><code>{CONTRACT_ADDRESS}</code></p><div style={{textAlign:'center', marginBottom:12}}>{!account ? <button onClick={connect}>Connect Wallet</button> : <div>Connected: {account}</div>}</div><div className='card'><h3>Options</h3><button onClick={loadProposals}>Refresh</button>{proposals.map((p,i)=>(<div key={i} style={{display:'flex', justifyContent:'space-between', marginTop:8}}><span>{p.name} â€” {p.votes}</span><button onClick={()=>submitVote(i)}>Vote</button></div>))}</div><div className='card'><h3>Simulated FHE</h3><p>Encrypted sample (local only):</p><textarea style={{width:'100%'}} rows={3} value={encryptedSample} readOnly /></div><div className='card'><h3>Actions</h3><button onClick={viewWinner}>Get Winner</button></div><div className='card'><strong>Status:</strong> {status}</div></div>); }